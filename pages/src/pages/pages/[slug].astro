---
import Layout from '../../layouts/Layout.astro';
import { Swell } from "../../swell/api";
import { getPage } from "../../swell/content";
import { SwellTheme } from "../../swell/theme";

const swell = new Swell(Astro);
const theme = new SwellTheme(swell);

await theme.init(Astro, 'pages/page');

const page = await getPage(swell, Astro.params.slug, theme.page?.query);

let title, description, content;

if (page) {
	title = page.meta_title || page.name;
	description = page.meta_description || page.description;
	[ content ] = await Promise.all([
		theme.renderPage({ page: { ...(theme.page || undefined), page } }, page.theme_template)
	]);
} else {
	title = 'Page not found';
	content = await theme.renderPageTemplate('404');
}
---

<Layout theme={theme} title={title} description={description}>
	<div slot="content_for_layout" set:html={content} />
</Layout>
