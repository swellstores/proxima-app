---
import { BlogResource } from '@/resources/blog';
import { handleServerRequest } from '@/utils/server';
import ThemePage from '@/components/ThemePage.astro';
import { parseResources } from '@/utils/server-resources';

import type { Swell } from '@swell/apps-sdk';

export async function getData(swell: Swell, slug?: string, category?: string) {
  return {
    blog: new BlogResource(swell, slug as string, category as string),
  };
}

export const getJSON = handleServerRequest(async ({ swell, context }) => {
  const data = await getData(
    swell,
    context.params.slug,
    context.params.category
  );
  return parseResources(data);
});
---

<ThemePage
  id="blogs/blog"
  required="blog.id"
  title="{{ blog.meta_title | default: blog.title }}"
  description="{{ blog.meta_description | default: blog.description }}"
  getData={(swell) => getData(swell, Astro.params.slug, Astro.params.category)}
/>
