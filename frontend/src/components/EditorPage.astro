---
import {
  Swell,
  SwellTheme,
  resolveAsyncResources,
  removeCircularReferences,
} from '@swell/apps-sdk';
import EasyblocksPage from './EasyblocksPage.tsx';

export interface Props {
  swell: Swell;
  theme: SwellTheme;
  pageProps: SwellData;
  pageContent: SwellData;
  layoutProps: SwellData;
}

let { swell, theme, pageProps, pageContent, layoutProps } = Astro.props;

let allSections = await theme.getAllSections();
let pageSections = await theme.getPageSections(pageContent, false);
let layoutSectionGroups = await theme.getLayoutSectionGroups(false);

let themeGlobals = theme.globals;
let swellClientProps = swell.getClientProps();

pageProps = await resolveAsyncResources({ ...themeGlobals, pageProps });

themeGlobals = removeCircularReferences(themeGlobals);
pageSections = removeCircularReferences(pageSections);
layoutSectionGroups = removeCircularReferences(layoutSectionGroups);
swellClientProps = removeCircularReferences(swellClientProps);
---

<EasyblocksPage
  pageId={theme.pageId}
  pageProps={pageProps}
  pageContent={pageContent}
  allSections={allSections}
  pageSections={pageSections}
  layoutSectionGroups={layoutSectionGroups}
  layoutProps={layoutProps}
  themeGlobals={themeGlobals}
  swellClientProps={swellClientProps}
  client:only="react"
/>
